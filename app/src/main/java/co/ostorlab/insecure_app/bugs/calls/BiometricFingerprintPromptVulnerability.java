package co.ostorlab.insecure_app.bugs.calls;

import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.widget.Toast;

import androidx.biometric.BiometricPrompt;
import androidx.fragment.app.FragmentActivity;

import co.ostorlab.insecure_app.BugRule;


public final class BiometricFingerprintPromptVulnerability extends BugRule {
    private FragmentActivity mActivity;

    public BiometricFingerprintPromptVulnerability(FragmentActivity activity) {
        mActivity = activity;

    }

    @Override
    public void run() throws Exception {
        Context context = getContext();

        BiometricPrompt.AuthenticationCallback authenticationCallback = new BiometricPrompt.AuthenticationCallback() {
            @Override
            public void onAuthenticationError(int errorCode, CharSequence errString) {
                super.onAuthenticationError(errorCode, errString);
                Toast.makeText(context, "Authentication error: " + errString, Toast.LENGTH_LONG).show();
            }

            @Override
            public void onAuthenticationSucceeded(BiometricPrompt.AuthenticationResult result) {
                super.onAuthenticationSucceeded(result);
                Toast.makeText(context, "Authentication Succeeded: " + result, Toast.LENGTH_LONG).show();
            }

            @Override
            public void onAuthenticationFailed() {
                super.onAuthenticationFailed();
                Toast.makeText(context, "Authentication Failed", Toast.LENGTH_LONG).show();
            }
        };
        BiometricPrompt.PromptInfo promptInfo = new BiometricPrompt.PromptInfo.Builder()
                .setTitle("Title")
                .setSubtitle("Subtitle")
                .setDescription("Description")
                .build();
        BiometricPrompt biometricPrompt = new BiometricPrompt(this.mActivity, authenticationCallback);
        biometricPrompt.authenticate(promptInfo);
    }

    @Override
    public String getDescription() {
        return "Biometric Fingerprint Prompt BiometricPrompt";
    }

    private static void showSuccessAlert(Context context) {
        new AlertDialog.Builder(context)
                .setTitle("Success")
                .setMessage("Login succeeded!")
                .setPositiveButton("OK", new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int whichButton) {
                        dialog.dismiss();
                    }
                }).show();
    }
}
